---

title: BigEarthNet Base Functions


keywords: fastai
sidebar: home_sidebar

summary: "A collection of common function that are applied to BEN."
description: "A collection of common function that are applied to BEN."
nb_path: "nbs/01_base.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_base.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Safe-JSON-Parsing">Safe JSON Parsing<a class="anchor-link" href="#Safe-JSON-Parsing"> </a></h2><p>A couple of safe parsing functions that guarantee flexible reading of the default BigEarthNet json entries.</p>
<p>Usually, you should not use any of these parsing functions directly, but use one of the higher-level functions instead.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="parse_datetime" class="doc_header"><code>parse_datetime</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L55" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>parse_datetime</code>(<strong><code>inp</code></strong>:<code>Union</code>[<code>str</code>, <code>datetime</code>])</p>
</blockquote>
<p>Parses an input into a <code>datetime</code> object.
Will try its best to infer the correct format from a string.
If a <code>datetime</code> object is already provided it will be returned.
Otherwise it will raise an error.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">d1</span> <span class="o">=</span> <span class="n">parse_datetime</span><span class="p">(</span><span class="s2">&quot;2017-06-13 10:10:31&quot;</span><span class="p">)</span>
<span class="n">d2</span> <span class="o">=</span> <span class="n">parse_datetime</span><span class="p">(</span><span class="s2">&quot;13.06.2017 10:10:31&quot;</span><span class="p">)</span>
<span class="n">d3</span> <span class="o">=</span> <span class="n">parse_datetime</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2017</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">31</span><span class="p">))</span>

<span class="n">test_eq</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span> <span class="n">d3</span><span class="p">)</span>

<span class="k">with</span> <span class="n">ExceptionExpected</span><span class="p">(</span><span class="n">ex</span><span class="o">=</span><span class="n">ParserError</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="s2">&quot;format&quot;</span><span class="p">):</span>
    <span class="n">parse_datetime</span><span class="p">(</span><span class="s2">&quot;large_tile&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">ExceptionExpected</span><span class="p">(</span><span class="n">ex</span><span class="o">=</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="s2">&quot;parse&quot;</span><span class="p">):</span>
    <span class="n">parse_datetime</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="k">with</span> <span class="n">ExceptionExpected</span><span class="p">(</span><span class="n">ex</span><span class="o">=</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="s2">&quot;parse&quot;</span><span class="p">):</span>
    <span class="n">parse_datetime</span><span class="p">(</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2017</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_S1_json" class="doc_header"><code>read_S1_json</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L116" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_S1_json</code>(<strong><code>json_fp</code></strong>:<code>FilePath</code>)</p>
</blockquote>
<p>A helper function that <em>safely</em> reads a BigEarthNet-S1 json file.
It will ensure that all expected entries are present and only read those
entries.
This helps to avoid issues where the JSON files were accidentally modified
or partially deleted.</p>
<p>Note: This function will also silently fix a typo present in the <code>coordinates</code> key
from version: S1_v1.0. A coordinates key is named <code>lly</code> and it should be <code>lry</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_S2_json" class="doc_header"><code>read_S2_json</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L134" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_S2_json</code>(<strong><code>json_fp</code></strong>:<code>FilePath</code>)</p>
</blockquote>
<p>A helper function that <em>safely</em> reads a BigEarthNet-S1 json file.
It will ensure that all expected entries are present and only read those
entries.
This helps to avoid issues where the JSON files were accidentally modified
or partially deleted.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Common-BEN-patch-checks-and-transformations">Common BEN patch checks and transformations<a class="anchor-link" href="#Common-BEN-patch-checks-and-transformations"> </a></h2><p>To quickly filter a list of directories and ensure that only Sentinel directories are accessed, use:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_s2_patch_directories" class="doc_header"><code>get_s2_patch_directories</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L146" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_s2_patch_directories</code>(<strong><code>dir_path</code></strong>:<code>DirectoryPath</code>)</p>
</blockquote>
<p>Will find all S2 patch directories in the provided <code>dir_path</code>.
Only directories that strictly cohere to the naming convention will be returned.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_s1_patch_directories" class="doc_header"><code>get_s1_patch_directories</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L159" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_s1_patch_directories</code>(<strong><code>dir_path</code></strong>:<code>DirectoryPath</code>)</p>
</blockquote>
<p>Will find all S1 patch directories in the provided <code>dir_path</code>.
Only directories that strictly cohere to the naming convention will be returned.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The following functions mainly allow the user to write cleaner code by importing them instead of writing lambda functions.
All functions use caches to guarantee fast lookups, so feel free to use them on large data.</p>
<p>The most relevant functions are:</p>
<ul>
<li>check if patch name in cloud/snow collection<ul>
<li><a href="/bigearthnet_common/base.html#is_snowy_patch"><code>is_snowy_patch</code></a></li>
<li><a href="/bigearthnet_common/base.html#is_cloudy_shadowy_patch"><code>is_cloudy_shadowy_patch</code></a></li>
</ul>
</li>
<li>Retrieve the original split by looking up the patch name<ul>
<li><a href="/bigearthnet_common/base.html#get_original_split_from_patch_name"><code>get_original_split_from_patch_name</code></a></li>
</ul>
</li>
<li>Convert the old 43-label nomenclature to the new 19-label variant<ul>
<li><a href="/bigearthnet_common/base.html#old2new_labels"><code>old2new_labels</code></a></li>
</ul>
</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_complete_s1_to_s2_patch_name_mapping" class="doc_header"><code>get_complete_s1_to_s2_patch_name_mapping</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L227" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_complete_s1_to_s2_patch_name_mapping</code>()</p>
</blockquote>
<p>Load entire Sentinel-1 to Sentinel-2 BigEarthNet patch name mapping.</p>
<p>Returns:
    Dict[str, str]: Sentinel-1 patch name keys with corresponding Sentinel-2 patch name as value</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_complete_s2_to_s1_patch_name_mapping" class="doc_header"><code>get_complete_s2_to_s1_patch_name_mapping</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L237" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_complete_s2_to_s1_patch_name_mapping</code>()</p>
</blockquote>
<p>Load entire Sentinel-2 to Sentinel-1 BigEarthNet patch name mapping.</p>
<p>Returns:
    Dict[str, str]: Sentinel-2 patch name keys with corresponding Sentinel-1 patch name as value</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="s1_to_s2_patch_name" class="doc_header"><code>s1_to_s2_patch_name</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L247" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>s1_to_s2_patch_name</code>(<strong><code>s1_patch_name</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Convert BigEarthNet Sentinel-1 patch name to Sentinel-2 patch name.
The function caches intermediate results.
The function should be highly performant.</p>
<p>Args:
    s1_patch_name (str): complete BigEarthNet Sentinel-1 patch name</p>
<p>Returns:
    str: Corresponding Sentinel-2 patch name</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="s2_to_s1_patch_name" class="doc_header"><code>s2_to_s1_patch_name</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L262" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>s2_to_s1_patch_name</code>(<strong><code>s2_patch_name</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Convert BigEarthNet Sentinel-2 patch name to Sentinel-1 patch name.
The function caches intermediate results.
The function should be highly performant.</p>
<p>Args:
    s2_patch_name (str): complete BigEarthNet Sentinel-2 patch name</p>
<p>Returns:
    str: Corresponding Sentinel-1 patch name</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_patches_to_country_mapping" class="doc_header"><code>get_patches_to_country_mapping</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L278" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_patches_to_country_mapping</code>(<strong><code>use_s2_patch_names</code></strong>:<code>bool</code>=<em><code>True</code></em>)</p>
</blockquote>
<p>Return a dictionary that maps a patch name to a country.
If <code>use_s2_patch_names</code> is set, use the BigEarthNet Sentinel-2 patch names.
Otherwise, use the Sentinel-1 patch names.</p>
<p>The compressed data could be regenerated with (requires the output of <code>bigearthnet_gdf_builder</code>):</p>
<blockquote><blockquote><blockquote><p>import geopandas
extended_gdf = geopandas.read_parquet("extended_ben_s1_gdf.parquet")
extended_gdf = raw_gdf.rename({"name": "s1_name", "corresponding_s2_patch": "s2_name"}, axis=1)
extended_gdf.to_csv("country.csv.bz2", columns=["s1_name", "s2_name", "country"], index=False)</p>
</blockquote>
</blockquote>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s2_country_mapping</span> <span class="o">=</span> <span class="n">get_patches_to_country_mapping</span><span class="p">()</span>
<span class="n">s1_country_mapping</span> <span class="o">=</span> <span class="n">get_patches_to_country_mapping</span><span class="p">(</span><span class="n">use_s2_patch_names</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">s1_country_mapping</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">s2_country_mapping</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
    <span class="n">s1_value</span> <span class="o">==</span> <span class="n">s2_value</span>
    <span class="k">for</span> <span class="n">s1_value</span><span class="p">,</span> <span class="n">s2_value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="n">s1_country_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">s2_country_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># validate that countries are only expected countries</span>
<span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">s2_country_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">ben_constants</span><span class="o">.</span><span class="n">COUNTRIES</span><span class="p">)</span>
<span class="c1"># check by visual inspection</span>
<span class="k">assert</span> <span class="n">s2_country_mapping</span><span class="p">[</span><span class="s2">&quot;S2A_MSIL2A_20171221T112501_56_35&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Portugal&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_patches_to_season_mapping" class="doc_header"><code>get_patches_to_season_mapping</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L296" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_patches_to_season_mapping</code>(<strong><code>use_s2_patch_names</code></strong>:<code>bool</code>=<em><code>True</code></em>)</p>
</blockquote>
<p>Return a dictionary that maps a patch name to the season of the acquisition date.
If <code>use_s2_patch_names</code> is set, use the BigEarthNet Sentinel-2 patch names.
Otherwise, use the Sentinel-1 patch names.</p>
<p>The compressed data could be regenerated with (requires the output of <code>bigearthnet_gdf_builder</code>):</p>
<blockquote><blockquote><blockquote><p>import geopandas
extended_gdf = geopandas.read_parquet("extended_ben_s1_gdf.parquet")
extended_gdf = raw_gdf.rename({"name": "s1_name", "corresponding_s2_patch": "s2_name"}, axis=1)
extended_gdf.to_csv("season.csv.bz2", columns=["s1_name", "s2_name", "season"], index=False)</p>
</blockquote>
</blockquote>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s2_season_mapping</span> <span class="o">=</span> <span class="n">get_patches_to_season_mapping</span><span class="p">()</span>
<span class="n">s1_season_mapping</span> <span class="o">=</span> <span class="n">get_patches_to_season_mapping</span><span class="p">(</span><span class="n">use_s2_patch_names</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">s1_season_mapping</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">s2_season_mapping</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
    <span class="n">s1_value</span> <span class="o">==</span> <span class="n">s2_value</span>
    <span class="k">for</span> <span class="n">s1_value</span><span class="p">,</span> <span class="n">s2_value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="n">s1_season_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">s2_season_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># There are only 4 seasons</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">s2_season_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="o">==</span> <span class="mi">4</span>
<span class="c1"># check by inspecting the acquisition time</span>
<span class="k">assert</span> <span class="n">s2_season_mapping</span><span class="p">[</span><span class="s2">&quot;S2A_MSIL2A_20171221T112501_56_35&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Winter&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_s2_patches_with_seasonal_snow" class="doc_header"><code>get_s2_patches_with_seasonal_snow</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L333" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_s2_patches_with_seasonal_snow</code>()</p>
</blockquote>
<p>List all patches with seasonal snow from <strong>original</strong> BigEarthNet-S2 dataset.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_s2_patches_with_cloud_and_shadow" class="doc_header"><code>get_s2_patches_with_cloud_and_shadow</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L339" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_s2_patches_with_cloud_and_shadow</code>()</p>
</blockquote>
<p>List all patches with cloud and shadow from <strong>original</strong> BigEarthNet-S2 dataset.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_s1_patches_with_seasonal_snow" class="doc_header"><code>get_s1_patches_with_seasonal_snow</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L345" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_s1_patches_with_seasonal_snow</code>()</p>
</blockquote>
<p>List all patches with seasonal snow from <strong>original</strong> BigEarthNet-S1 dataset.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_s1_patches_with_cloud_and_shadow" class="doc_header"><code>get_s1_patches_with_cloud_and_shadow</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L352" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_s1_patches_with_cloud_and_shadow</code>()</p>
</blockquote>
<p>List all patches with cloud and shadow from <strong>original</strong> BigEarthNet-S1 dataset.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s2_snow_patches</span> <span class="o">=</span> <span class="n">get_s2_patches_with_seasonal_snow</span><span class="p">()</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">s2_snow_patches</span><span class="p">)</span> <span class="o">==</span> <span class="n">ben_constants</span><span class="o">.</span><span class="n">BEN_SNOWY_PATCHES_COUNT</span>
<span class="n">s1_snow_patches</span> <span class="o">=</span> <span class="n">get_s1_patches_with_seasonal_snow</span><span class="p">()</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">s1_snow_patches</span><span class="p">)</span> <span class="o">==</span> <span class="n">ben_constants</span><span class="o">.</span><span class="n">BEN_SNOWY_PATCHES_COUNT</span>

<span class="n">s2_cloud_and_shadow_patches</span> <span class="o">=</span> <span class="n">get_s2_patches_with_cloud_and_shadow</span><span class="p">()</span>
<span class="k">assert</span> <span class="p">(</span>
    <span class="nb">len</span><span class="p">(</span><span class="n">s2_cloud_and_shadow_patches</span><span class="p">)</span>
    <span class="o">==</span> <span class="n">ben_constants</span><span class="o">.</span><span class="n">BEN_CLOUDY_OR_SHADOWY_PATCHES_COUNT</span>
<span class="p">)</span>
<span class="n">s1_cloud_and_shadow_patches</span> <span class="o">=</span> <span class="n">get_s1_patches_with_cloud_and_shadow</span><span class="p">()</span>
<span class="k">assert</span> <span class="p">(</span>
    <span class="nb">len</span><span class="p">(</span><span class="n">s1_cloud_and_shadow_patches</span><span class="p">)</span>
    <span class="o">==</span> <span class="n">ben_constants</span><span class="o">.</span><span class="n">BEN_CLOUDY_OR_SHADOWY_PATCHES_COUNT</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="is_snowy_patch" class="doc_header"><code>is_snowy_patch</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L360" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>is_snowy_patch</code>(<strong><code>patch_name</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Fast function that checks whether <code>patch_name</code> is a patch
that contains a lot of seasonal snow.</p>
<p>This works for S1 and S2 patch names!</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="is_cloudy_shadowy_patch" class="doc_header"><code>is_cloudy_shadowy_patch</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L374" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>is_cloudy_shadowy_patch</code>(<strong><code>patch_name</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Fast function that checks whether <code>patch_name</code> is a patch
that contains a lot of shadow or is obstructed by clouds.</p>
<p>This works for S1 and S2 patch names!</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_s2_patches_with_no_19_class_target" class="doc_header"><code>get_s2_patches_with_no_19_class_target</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L389" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_s2_patches_with_no_19_class_target</code>()</p>
</blockquote>
<p>List all patches from the BigEarthNet-S2 dataset that
have <em>no</em> defined classes with the 19-class nomenclature.</p>
<p>Note: This set still includes patches with snow, clouds, or shadows.</p>
<p>To re-build the file, it is necessary to use the output of <code>bigearthnet_gdf_builder</code>:</p>
<blockquote><blockquote><blockquote><p>raw_gdf = geopandas.read_parquet("raw_ben_s2_gdf.parquet")
raw_gdf["new_labels"] = raw_gdf["labels"].apply(old2new_labels)
no_19_label_targets = raw_gdf[raw_gdf["new_labels"].isna()]
no_19_label_targets.to_csv("patches_with_no_19_class_targets.csv.bz2", columns=["name"], index=False, header=False)</p>
</blockquote>
</blockquote>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_s1_patches_with_no_19_class_target" class="doc_header"><code>get_s1_patches_with_no_19_class_target</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L406" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_s1_patches_with_no_19_class_target</code>()</p>
</blockquote>
<p>List all patches from the BigEarthNet-S1 dataset that
have <em>no</em> defined classes with the 19-class nomenclature.</p>
<p>Note: This set still includes patches with snow, clouds, or shadows.</p>
<p>The patch names are converted from <code>get_s2_patches_with_no_19_class_targets</code>
for compactness.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_s2_patches_from_original_train_split" class="doc_header"><code>get_s2_patches_from_original_train_split</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L428" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_s2_patches_from_original_train_split</code>()</p>
</blockquote>
<p>List all Sentinel-2 train patches from the original train/validation/test split.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_s1_patches_from_original_train_split" class="doc_header"><code>get_s1_patches_from_original_train_split</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L436" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_s1_patches_from_original_train_split</code>()</p>
</blockquote>
<p>List all Sentinel-1 train patches from the original train/validation/test split.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_s2_patches_from_original_validation_split" class="doc_header"><code>get_s2_patches_from_original_validation_split</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L445" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_s2_patches_from_original_validation_split</code>()</p>
</blockquote>
<p>List all Sentinel-2 validation patches from the original train/validation/test split.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_s1_patches_from_original_validation_split" class="doc_header"><code>get_s1_patches_from_original_validation_split</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L453" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_s1_patches_from_original_validation_split</code>()</p>
</blockquote>
<p>List all Sentinel-1 validation patches from the original train/validation/test split.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_s2_patches_from_original_test_split" class="doc_header"><code>get_s2_patches_from_original_test_split</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L462" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_s2_patches_from_original_test_split</code>()</p>
</blockquote>
<p>List all Sentinel-2 test patches from the original train/validation/test split.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_s1_patches_from_original_test_split" class="doc_header"><code>get_s1_patches_from_original_test_split</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L470" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_s1_patches_from_original_test_split</code>()</p>
</blockquote>
<p>List all Sentinel-1 test patches from the original train/validation/test split.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_original_split_from_patch_name" class="doc_header"><code>get_original_split_from_patch_name</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L480" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_original_split_from_patch_name</code>(<strong><code>patch</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Returns "train"/"validation"/"test" or <code>None</code>.
The value is retrieved from the original BigEarthNet-S1/S2
train/validation/test split. If the input is not present
in any split, it will return <code>None</code> and raise a UserWarning.
This happens for patches that are either in the
cloud/shadow or seasonal snow set or if there exists no 19-label target.</p>
<p>Note: This works for Sentinel-2 and Sentinel-1 patch names!</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="s2">&quot;train&quot;</span> <span class="o">==</span> <span class="n">get_original_split_from_patch_name</span><span class="p">(</span><span class="s2">&quot;S2A_MSIL2A_20170717T113321_28_87&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="s2">&quot;validation&quot;</span> <span class="o">==</span> <span class="n">get_original_split_from_patch_name</span><span class="p">(</span>
    <span class="s2">&quot;S2B_MSIL2A_20170812T092029_75_6&quot;</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="s2">&quot;test&quot;</span> <span class="o">==</span> <span class="n">get_original_split_from_patch_name</span><span class="p">(</span><span class="s2">&quot;S2A_MSIL2A_20170717T113321_28_88&quot;</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">get_original_split_from_patch_name</span><span class="p">(</span><span class="s2">&quot;wrong_input&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>

<span class="c1"># snowy patches</span>
<span class="k">assert</span> <span class="n">get_original_split_from_patch_name</span><span class="p">(</span><span class="s2">&quot;S2B_MSIL2A_20170906T101019_33_85&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>

<span class="k">assert</span> <span class="s2">&quot;train&quot;</span> <span class="o">==</span> <span class="n">get_original_split_from_patch_name</span><span class="p">(</span>
    <span class="s2">&quot;S1A_IW_GRDH_1SDV_20170802T163350_34TCR_78_45&quot;</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="s2">&quot;validation&quot;</span> <span class="o">==</span> <span class="n">get_original_split_from_patch_name</span><span class="p">(</span>
    <span class="s2">&quot;S1B_IW_GRDH_1SDV_20170701T182622_29SND_64_30&quot;</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="s2">&quot;test&quot;</span> <span class="o">==</span> <span class="n">get_original_split_from_patch_name</span><span class="p">(</span><span class="s2">&quot;S2A_MSIL2A_20170717T113321_28_88&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span>
    <span class="n">get_original_split_from_patch_name</span><span class="p">(</span><span class="s2">&quot;S1A_IW_GRDH_1SDV_20170904T161304_34VDN_33_85&quot;</span><span class="p">)</span>
    <span class="ow">is</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="old2new_labels" class="doc_header"><code>old2new_labels</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L526" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>old2new_labels</code>(<strong><code>old_labels</code></strong>:<code>Sequence</code>[<code>str</code>])</p>
</blockquote>
<p>Converts a list of old-style BigEarthNet labels
to a list of labels.</p>
<p>If there are no corresponding new labels (which can happen with original BEN patches!)
then the function will return <code>None</code> and raise a user warning.</p>
<p>If an illegal/unknown input label is provided, a <code>KeyError</code> is raised.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include warning.html content='Some of the original 43-class nomenclature patches have 0 labels with the 19-class nomenclature! This function might return <code>None</code> instead of an empty list!' %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ben_19_labels_to_multi_hot" class="doc_header"><code>ben_19_labels_to_multi_hot</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L549" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ben_19_labels_to_multi_hot</code>(<strong><code>labels</code></strong>:<code>Sequence</code>[<code>str</code>])</p>
</blockquote>
<p>Convenience function that converts an input sequence of labels into
a multi-hot encoded vector.
The naturally ordered label list is used as an encoder reference</p>
<ul>
<li><code>bigearthnet_common.NEW_LABELS</code></li>
</ul>
<p>If an unknown label is given, a <code>KeyError</code> is raised.</p>
<p>Be aware that this approach assumes that <strong>all</strong> labels are actually used in the dataset!
This is not necessarily the case if you are using a subset!
For example, the "Agro-forestry areas" class is only present in Portugal and in no other country!</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ben_43_labels_to_multi_hot" class="doc_header"><code>ben_43_labels_to_multi_hot</code><a href="https://github.com/kai-tub/bigearthnet_common/tree/main/bigearthnet_common/base.py#L569" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ben_43_labels_to_multi_hot</code>(<strong><code>labels</code></strong>:<code>Sequence</code>[<code>str</code>])</p>
</blockquote>
<p>Convenience function that converts an input sequence of labels into
a multi-hot encoded vector.
The naturally ordered label list is used as an encoder reference</p>
<ul>
<li><code>bigearthnet_common.OLD_LABELS</code></li>
</ul>
<p>If an unknown label is given, a <code>KeyError</code> is raised.</p>
<p>Be aware that this approach assumes that <strong>all</strong> labels are actually used in the dataset!
This is not necessarily the case if you are using a subset!
For example, the "Agro-forestry areas" class is only present in Portugal and in no other country!</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">agro</span> <span class="o">=</span> <span class="n">ben_19_labels_to_multi_hot</span><span class="p">((</span><span class="s2">&quot;Agro-forestry areas&quot;</span><span class="p">,))</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">agro</span><span class="p">)</span> <span class="o">==</span> <span class="mi">19</span>
<span class="k">assert</span> <span class="n">agro</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">agro</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

<span class="n">multi</span> <span class="o">=</span> <span class="n">ben_19_labels_to_multi_hot</span><span class="p">((</span><span class="s2">&quot;Agro-forestry areas&quot;</span><span class="p">,</span> <span class="s2">&quot;Arable land&quot;</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">multi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span>
<span class="k">assert</span> <span class="n">multi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">multi</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>

<span class="k">with</span> <span class="n">fc</span><span class="o">.</span><span class="n">ExceptionExpected</span><span class="p">(</span><span class="n">ex</span><span class="o">=</span><span class="ne">KeyError</span><span class="p">):</span>
    <span class="n">ben_19_labels_to_multi_hot</span><span class="p">([</span><span class="s2">&quot;Airports&quot;</span><span class="p">])</span>

<span class="n">agro43</span> <span class="o">=</span> <span class="n">ben_43_labels_to_multi_hot</span><span class="p">((</span><span class="s2">&quot;Agro-forestry areas&quot;</span><span class="p">,))</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">agro43</span><span class="p">)</span> <span class="o">==</span> <span class="mi">43</span>
<span class="k">assert</span> <span class="n">agro43</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">agro43</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

<span class="n">multi43</span> <span class="o">=</span> <span class="n">ben_43_labels_to_multi_hot</span><span class="p">((</span><span class="s2">&quot;Agro-forestry areas&quot;</span><span class="p">,</span> <span class="s2">&quot;Airports&quot;</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">multi43</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span>
<span class="k">assert</span> <span class="n">multi43</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">multi43</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>

<span class="k">with</span> <span class="n">fc</span><span class="o">.</span><span class="n">ExceptionExpected</span><span class="p">(</span><span class="n">ex</span><span class="o">=</span><span class="ne">KeyError</span><span class="p">):</span>
    <span class="n">ben_43_labels_to_multi_hot</span><span class="p">([</span><span class="s2">&quot;Arable land&quot;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

